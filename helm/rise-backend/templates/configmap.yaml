apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "rise-backend.fullname" . }}-config
  labels:
    {{- include "rise-backend.labels" . | nindent 4 }}
data:
  config.toml: |
    [server]
    host = {{ .Values.config.server.host | quote }}
    port = {{ .Values.config.server.port }}
    public_url = {{ .Values.config.server.publicUrl | quote }}

    [auth]
    issuer = {{ .Values.config.auth.issuer | quote }}
    client_id = {{ .Values.config.auth.clientId | quote }}
    {{- if .Values.config.auth.adminUsers }}
    admin_users = [
      {{- range .Values.config.auth.adminUsers }}
      {{ . | quote }},
      {{- end }}
    ]
    {{- end }}

    [registry]
    type = {{ .Values.config.registry.type | quote }}
    registry_url = {{ .Values.config.registry.registryUrl | quote }}
    namespace = {{ .Values.config.registry.namespace | quote }}

    {{- if .Values.config.kubernetes.enabled }}
    [kubernetes]
    ingress_class = {{ .Values.config.kubernetes.ingressClass | quote }}
    domain_suffix = {{ .Values.config.kubernetes.domainSuffix | quote }}
    {{- end }}
